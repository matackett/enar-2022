---
title: "An analysis of social media & electronic device use"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    css: "css/app-style.css"
runtime: shiny_prerendered
---


<!-- Add JavaScript code for making the exercise code larger -->
<script language="JavaScript" src="js/exercise-font-size.js"></script>


```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(tidyverse)
library(googlesheets4)
library(viridis)
library(waffle)

# remove authorization from googlesheet
gs4_deauth()

tutorial_options(
  # code running in exercise times out after 30 seconds
  exercise.timelimit = 30, 
  )

# hide non-exercise code chunks
knitr::opts_chunk$set(echo = FALSE,
                      warning = FALSE, 
                      message = FALSE)

# set ggplot options 

theme_set(theme_bw())

viridis_qualitative_pal7 <- c("#440154FF", "#DCE319FF", "#443A83FF", 
                              "#8FD744FF", "#31688EFF",  "#35B779FF", 
                              "#21908CFF") #replace the first yellow color

scale_fill_discrete <- function(...) {
   scale_fill_manual(..., values = viridis_qualitative_pal7)
} 

scale_colour_discrete <- function(...) {
  scale_colour_manual(..., values = viridis_qualitative_pal7)
}


# read in survey responses
responses <- read_sheet("https://docs.google.com/spreadsheets/d/12TImpxFxdObvzjCVgQK6paPp0AxgN-1lSGg7CKfvCUM/edit?usp=sharing")

# prep data 
responses <- responses %>%
  select(-Timestamp) %>%
  rename(school_level = `Are you a high school or undergraduate student?`,
         school_format = `Are you primarily attending classes in person or online?`, 
         device_school = `About what percent of waking hours do you spend using an electronic device for something related to school, such as attending classes, studying, homework, etc.?`, 
         device_leisure = `About what percent of waking hours do you spend on an electronic device for leisure activities, such as social media, watching TV, chatting with friends, etc.?`, 
         social_media = `What social media platforms do you use? Select all that apply.`, 
         region = `What region do you live in?`)

# reorder variables
responses <- responses %>%
  select(region, everything())
```

## Introduction 

Welcome! In this tutorial, we'll learn R functions that can help us wrangle, summarize, and visualize your survey responses and learn a little more about you! 

### Packages

We'll use the **tidyverse**, "an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.” 

Run the code to load the **tidyverse**.

```{r load-packages, exercise = TRUE}
library(tidyverse)
```

## Data

### Your survey responses 

The data set `responses` contains your responses to the [survey](https://forms.gle/Txz92ytAmngd5TZy6) you took during this workshop. 

Here is the codebook for `responses`:

- `region`: Northeast, South, Midwest, West
- `school_level`: High School or Undergraduate
- `school_format`: How you're primarily attending school right now (In person or Online)
- `device_school`: percent of waking hours spent using electronic devices for school 
- `device_leisure`: percent of waking hours spent using electronic devices for leisure activities
- `social_media`: Which social media platforms you typically use (Facebook, Twitter, Instagram, Snapchat, TikTok, Other, None/ I don't use social media)

### Let's take look at the data

Run the code to view the first five rows of the data set.

```{r view-data, exercise = TRUE}
responses %>%
  slice(1:5)
```

## School

### School format

**How many students are high school students? College undergraduates?** To answer this question, we can use the `count` function to count the number of students at each level of `school_level`. 

```{r school-level-count, exercise = TRUE}
responses %>%
  count(school_level)
```

Now let's make a bar plot to visualize these counts! 

```{r school-level-bar, exercise  = TRUE}
ggplot(data = responses, aes(x = school_level)) +
  geom_bar() 
```

### Customize the bar plot

There are many ways to customize plots made with `ggplot`. For now, let's change the color of the bars and add a title. 

- To change the color of the bars, we'll include the  `fill = "[COLOR]"` inside `geom_bar()`. In the code below, you can see that we've changed the color of the bars to blue. 
- We'll add a title by including `labs()`. 

Update the code by replacing `blue` with a color of your choice and adding a title. You can [click here](https://www.r-graph-gallery.com/42-colors-names.html) for a list of colors. 

```{r school-level-custom, exercise = TRUE}
ggplot(data = responses, aes(x = school_level)) +
  geom_bar(fill = "blue") + 
  labs(title = "___")
```

### School format by level

**Are high school or undergraduates students more likely to be attending classes online?**

We can use the `group_by()` function to count number of students attending classes in person or online for each school level. 

```{r level-format-count, exercise = TRUE}
responses %>% 
  group_by(school_level) %>%
  count(school_format)
```

### Visualize school format by level

Let's visualize the relationship between `school_format` and `school_level`. We can update the original bar plot of `school_level` by filling in the color of the bars based on `school_format`. 

Since we want to fill in the color of the bars based on a variable (instead of making them the same color as before), we will 

- Include `fill = school_format` in the `aes`thetics
- Include `position = "fill"` in `geom_bar()`

Fill in the code to make a bar plot of `school_level` with the bars filled in based on `school_format`. This is a **stacked barplot**.  

```{r school-level-stacked, exercise = TRUE}
ggplot(data = responses, aes(x = school_level, fill = ___)) +
  geom_bar(position = "___") +
  labs(title = "___")
```

### Your Turn! 

**Is there a relationship between where students live and whether they are attending classes in person or online?**

Start by counting the number of students attending school in person and online by region. 

```{r school-format-region, exercise = TRUE}
## count of school_format by region

```

Then, make a stacked bar chart of  `region`, filling in the color based on `school_format`. 

```{r region-school, exercise = T}
#bar plot of school format vs. region 

```

**What are some similarities and differences you observe about the way students in each region are attending school?**

## Electronic devices

What's the relationship between the percent of time students use an electronic device for school versus for leisure activities?

Let's make a scatterplot to find out!

### Electronic device use

We can use `geom_point()` to make scatterplots in `ggplot`. 

Run the code below to make a scatterplot of time you use electronic devices for school versus leisure. 

```{r time-on-device, exercise = TRUE}
ggplot(data = responses, aes(x = device_school, y = device_leisure)) +
  geom_point()
```


### Electronic device use by school format

Now let's see if the relationship between `device_school` and `device_leisure` differs for students attending classes in person versus those attending classes online.

We'll add color to our scatterplot to look at the difference by school format.

```{r device-by-format, exercise = TRUE}
ggplot(data = responses, aes(x = device_school, y = device_leisure, 
                             color = school_format)) +
  geom_point()
```

### Visualize general trend

We can also use `geom_smooth()` to get a better view of the general relationship between the variables.  

```{r device-by-format-smooth, exercise = TRUE}
ggplot(data = responses, aes(x = device_school, y = device_leisure, 
                             color = school_format)) +
  geom_point() +
  geom_smooth()
```

### Let's add school level

Do the observations we've made about electronic device use differ for high school and undergraduate students?

Let's add a `facet_wrap` to look at separate scatterplots based on school level.  We'll also add axis labels and a title to the plot.

```{r device-by-format-facet, exercise = TRUE}
ggplot(data = responses, aes(x = device_school, y = device_leisure, 
                             color = school_format)) +
  geom_point() +
  geom_smooth() +
  facet_wrap(vars(school_level)) + 
  labs(x = "% time using device for school", 
      y = "% time using device for leisure", 
      title = "Electronic device use by class format", 
      subtitle = "For high school and undergraduate students")
```

### Your turn!

Explore the relationship between `device_school` and `device_leisure` by region and school format. Make a scatterplot using color and faceting to visualize the relationship between these variables. 

```{r device-by-region, exercise = TRUE}
# add your code here!

```

**Based on your plot, what do you observe about the relationship between these variables?**

## Social Media

### View `social_media`

Now let's analyze the social media data. Let's start by using the `select` function to take a look at this variable.

```{r instagram-1, exercise = TRUE}
responses %>%
  select(social_media)
```

### Make Instagram variable

We want to calculate the percent of students who use Instagram. 
students could select multiple social media platforms in the survey, so we need to make a new variable to indicate whether Instagram is included in their answer.  

We'll use the `str_detect` and `mutate` functions this new variable.

- `str_detect`: returns the value **TRUE** if "Instagram" is included in `social_media` and **FALSE** otherwise.
- `mutate`: Add the new variable to the data set

We use the `<-` to save the updated data set, so we can use the new variable for analysis.

Run the code below to make the new variable and view the `social_media` and `instagram` variables. 
```{r instagram-2, exercise = TRUE}
responses <- responses %>%
  mutate(instagram  = str_detect(social_media, "Instagram"))

responses %>%
  select(social_media, instagram)
```

### Calculate percent Instagram 

We want to calculate the percent of students who use Instagram. We'll start by counting the number of students in each category of `instagram` then create a new variable of the corresponding percents. 

```{r instagram-percent, exercise = TRUE, exercise.setup = "instagram-2"}
responses %>%
  count(instagram) %>%
  mutate(percent = n / sum(n) * 100)
```

### Your turn! TikTok users

What percent of students use TikTok? Make a new variable that indicates whether a student selected TikTok, then calculate the percent of students who are TikTok users?

Fill in the code below to make a new variable to indicate whether students use TikTok. Then, view the data with your new variable. 

```{r tik-tok, exercise = TRUE, exercise.setup = "instagram-2"}
responses <- responses %>%
  ___(tiktok = ___(___, "___"))

responses %>%
  select(social_media, tiktok)
```


Now calculate the percent of students who use TikTok. 

```{r tik-tok-data, include  = FALSE}
responses <- responses %>%
  mutate(tiktok = str_detect(social_media, "TikTok"))
```


```{r tik-tok-percent, exercise = TRUE, exercise.setup = "tik-tok-data"}
responses %>%
  ___(___) %>%
  mutate(percent = n / sum(___) * 100)
```

### Relationship between TikTok and Instagram

Are students who use TikTok more likely to also use Instagram? Use the functions we've learned today to find out! You can make a visualization, calculate summary statistics, or both! It's up to you!

```{r tik-tok-instagram, exercise = TRUE, exercise.setup = "tik-tok-data" }
## Add your code here

```

## Learn more!

Below are a few resources to keep learning more about R and the tidyverse!

- [R for Data Science](https://r4ds.had.co.nz/)
- [RStudio Primers](https://rstudio.cloud/learn/primers)
- [tidyverse.org](https://www.tidyverse.org/)



