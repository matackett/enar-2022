---
title: "Survey analysis (update title)"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    css: "css/app-style.css"
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tidyverse)
library(tidyverse)
library(googlesheets4)
library(viridis)
library(waffle)

# remove authorization from googlesheet
gs4_deauth()

tutorial_options(
  # code running in exercise times out after 30 seconds
  exercise.timelimit = 30, 
  )

# hide non-exercise code chunks
knitr::opts_chunk$set(echo = FALSE)

# set ggplot options 

theme_set(theme_bw())

viridis_qualitative_pal7 <- c("#440154FF", "#DCE319FF", "#443A83FF", 
                              "#8FD744FF", "#31688EFF",  "#35B779FF", 
                              "#21908CFF") #replace the first yellow color

scale_fill_discrete <- function(...) {
   scale_fill_manual(..., values = viridis_qualitative_pal7)
} 

scale_colour_discrete <- function(...) {
  scale_colour_manual(..., values = viridis_qualitative_pal7)
}


# read in survey responses
responses <- read_sheet("https://docs.google.com/spreadsheets/d/12TImpxFxdObvzjCVgQK6paPp0AxgN-1lSGg7CKfvCUM/edit?usp=sharing")

# prep data 
responses <- responses %>%
  select(-Timestamp) %>%
  rename(school_level = `Are you currently in high school or undergraduate?`,
         school_format = `Are you primarily attending school in person or online?`, 
         device_school = `About what percentage of your waking hours do you spend using an electronic device for something related to school? This can include attending classes, studying, homework, club meetings, etc.`, 
         device_leisure = `About what percentage of your waking hours do you spend on an electronic device for leisure activities?`, 
         social_media = `What type of social media do you use? Select all that apply.`, 
         region = `What region do you live in?`)
```

## Introduction 

Welcome! In this tutorial, we'll learn R functions that can help us wrangle, summarize, and visualize your survey responses and learn a little more about you! 

### Packages

We'll use the **tidyverse**, "an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.” 

Use the code below to load the **tidyverse**! 

```{r load-packages, exercise = TRUE}
library(tidyverse)
```

## Data

### Your survey responses 

The data frame `responses` contains your responses to the [survey](https://forms.gle/Txz92ytAmngd5TZy6) you took during this workshop. 

Here is the codebook for `responses`:

- `school_level`: High School or Undergraduate
- `school_format`: How you're primarily attending school right now (In person or Online)
- `device_school`: Percentage of waking hours spent using electronic devices for school 
- `device_leisure`: Percentage of waking hours spent using electronic devices for leisure activities
- `social_media`: Which social media platforms you typically use
- `region`: Northeast, South, Midwest, West

### Let's take look at the data

We can use the `slice` function to view the first 5 rows of the data set. 

```{r view-data, exercise = TRUE}
responses %>%
  slice(1:5)
```

## School

### School level

How many students are currently in high school versus college undergraduates? 

Run the code below to make a bar plot of `school_level`. 

```{r hs-undergrad, exercise  = TRUE}
ggplot(data = responses, aes(x = school_level)) +
  geom_bar() 
```

### Customize the plot

We can customize our plot by adding labels and changing the color of the bars. 

- To add labels, we'll use the `labs()` function. 
- To change the color of the bars, we'll add `fill = "color-name"` in `geom_bar()`. For example, if we want to make the bars blue, we can add `fill = "blue"` in `geom_bar()`. 

Fill in the code to update the bar plot of `school_level` by changing the color of the bars and adding a title.  If you need some inspiration, [click here](https://www.r-graph-gallery.com/42-colors-names.html) for a list of colors.

```{r hs-undergrad-2, exercise = TRUE}
ggplot(data = ___, aes(x = ___)) +
  geom_bar(fill = "___") + 
  labs(title = "___")
```


### School level vs. School format 

Are high school or undergraduates students more likely to be attending classes online? 

Let's update the bar plot filling in the bars based on the school format. To do so, we'll 

- Include `fill = school_format` in the `aes`thetics
- Include `position = "fill"` in `geom_bar()`

Fill in the code to add a title and make the stacked bar plot.

```{r hs-undergrad-3, exercise = TRUE}
ggplot(data = responses, aes(x = school_level, fill = school_format)) +
  geom_bar(position = "fill") +
  labs(title = "___")
```


### Your Turn! 

Is there a relationship between where students live and whether they are attending classes in person or online?

Make a bar plot of `region`, filling in the bars based on `school_format`. 

```{r region-school, exercise = T}
#bar plot of school format vs. region 

```


## Electronic devices

What's the relationship between the percentage of time you use an electronic device for school versus for leisure activities in your free time? 

Let's make a scatterplot to find out!

### `device_school` versus `device_leisure`

We can use `geom_point()` to make scatterplots in `ggplot`. 

Run the code below to make a scatterplot of time you use electronic devices for school versus leisure. 

```{r time-on-device, exercise = TRUE}
ggplot(data = responses, aes(x = device_school, y = device_leisure)) +
  geom_point()
```

### `device_school` versus `device_leisure` by `school_level`

Does the relationship between `device_school` and `device_leisure` differ for high school and college students?

To find out, we can add `color = group_var` to the `aes`thetic, where `group_var` is the variable we want to color by.  

Fill in the code to color the points on the scatterplot by `school_level` and add axis labels and a title.

```{r time-on-device-2, exercise = TRUE}
ggplot(data = responses, aes(x = device_school, y = device_leisure, color = ___)) +
  geom_point() +
  labs(x = "___", 
      y = "___", 
      title = "___")
```

### Facet by school format

Do the observations we've made about electronic device use differ based on region?  

Let's add a `facet_wrap` to look at separate scatterplots based on school level. 

```{r time-on-device-3, exercise = TRUE}
ggplot(data = responses, aes(x = device_school, y = device_leisure, color = school_level)) +
  geom_point() +
  facet_wrap(vars(school_format)) + 
  labs(x = "% time using device for school", 
      y = "% time using device for leisure", 
      title = "Time spent using device for school vs. leisure for HS and college students", 
      subtitle = "Faceted by class format")
```

### Your turn!

Does the relationship between device usage for school versus leisure activities differ for students attending school in person versus online? Is this relationship different for students who live in different regions? 

Start by making a scatterplot of `device_school` versus `device_lesiure` with the color based on `school_format`. 
Then update the plot by faceting by `region`. 

```{r time-on-device-4, exercise = TRUE}
# add your code here!

```

**What are some observations about the way students use electronic devices? How do these observations differ based on school level, school format, and region?**

## Facebook

Do a majority of students here use Facebook? 

We can use the `social_media` variable to answer help answer this question. Let's take a look at this variable using the `select` function.

```{r facebook-1, exercise = TRUE}
responses %>%
  select(social_media)
```

### Use `str_detect` to identify Facebook users

Respondents could select multiple social media platform, so we need a way to figure out whether Facebook is included in their answer. 

To do so, we'll use the `str_detect` and `mutate` functions  to create a new variable identifying whether the respondent uses Facebook. 

- `str_detect`: returns the value **TRUE** if "Facebook" is included in `social_media` and **FALSE** otherwise.
- `mutate`: Add the new variable to the data set

Run the code below to create the variable `facebook`. 

```{r facebook-2, exercise = TRUE}
responses <- responses %>%
  mutate(facebook  = str_detect(social_media, "Facebook"))
```

Now let's take a look at the data. 

```{r facebook-3, exercise = TRUE, exercise.setup = "facebook-2"}
responses %>%
  select(social_media, facebook)
```

### Visualize `facebook`

Let's make a bar plot to visualize `facebook`.

```{r facebook-4, exercise = TRUE, exercise.setup = "facebook-2"}

```

### Facebook and `device_leisure`

Are facebook users more likely to spend more time using their device for leisure? To answer this question, we'll make a histogram of `device_leisure` faceted by `facebook. 

```{r facebook-hist, exercise = TRUE, exercise.setup = "facebook-2"}
ggplot(data = ___, aes(x = ___, color = facebook)) +
  geom_histogram() +
  facet_wrap(___)
```

## Your turn! 

Choose another social media platform in from the survey and visualize the responses!

You can choose from 

- "Instagram" 
- "Twitter"
- "Snapchat"
- "Other"
- "None/ I don't use social media"

### Make a new variable

Fill in the code below to use the `str_detect` and `mutate` functions to create a new variable. 

```{r social-media, exercise = TRUE, exercise.setup = "facebook-2"}
responses <- ___ %>%
  ___(str_detect(___, "___"))
```

Take a look at your new variable

```{r social-media-2, exercise = TRUE, exercise.setup = "facebook-2"}
___ %>%
  select(social_media, ___)
```

### Visualize it! 

Make a bar plot of your social media variable and customize the plot! 

```{r social-media-3, exercise = TRUE, exercise.setup = "social-media-2"}
# make a bar plot of your social media variable

```

### Relationship between variables

Now make a plot of explore the relationship between your social media variable and any of other variables we've used in this analysis!

```{r social-media-4,exercise = TRUE, exercise.setup = "social-media-2" }
## Make a plot to visualize the relationship

```

## Learn more!

Below are a few resources to keep learning more about R and the tidyverse!

- [R for Data Science](https://r4ds.had.co.nz/)
- [RStudio Primers](https://rstudio.cloud/learn/primers)
- [tidyverse.org](https://www.tidyverse.org/)



